這份 M365 品管系統標準規格書 整合了您最新的工程階段資料（01 假設工程至 10 大廳裝修工程）以及我們先前定案的「前、後台分離」與「網格比例座標」核心技術。這套規格書將作為您未來所有工地與工程版本開發的唯一標準 。
________________________________________
M365 品管系統標準規格書 (模組化範本版)
一、 系統願景與架構總覽 (System Architecture)
本系統採「中樞與分支 (Hub-and-Spoke)」架構，旨在將複雜的工程數據轉化為極簡的行動化作業：
●	資料中樞 (SharePoint Hub)：統一儲存所有專案基礎資料、查驗目錄及歷史紀錄 。
●	後台 APP (Office Admin)：辦公室專用，負責平面圖管理與固定座標點位 (L1b) 的標定 。
●	前台 APP (Field Inspection)：現場工務專用，依據「四階段導覽」進行精準查驗與快速驗收 。
________________________________________
二、 資料中心 (SharePoint) 規格標準
所有工程版本必須遵循此清單結構，以確保 APP 邏輯可直接複製 。
1. 基礎與目錄清單 (共用)
●	L0 - 平面圖庫：儲存各樓層底圖（欄位：棟別、樓層、圖面縮圖） 。
●	L1 - 戶別樓層：專案結構主檔（欄位：棟別、樓層、戶號 ID） 。
●	L1b - 空間座標主檔：定義地圖上的「錨點」，儲存 PointX、PointY 比例座標 。
●	L2/L2a/L2b - 工程目錄：
○	L2 (階段)：如 05 內裝工程、07 門窗工程。
○	L2a (工項)：如 07B 木門工程、08G 廚具工程。
○	L2b (缺失內容)：標準化描述與責任廠商對照表 。
2. 標準化查驗紀錄 (L3 Template) 所有工項紀錄清單（如 L3a 木門）必須包含以下統一欄位 ：
●	定位關聯：樓層戶別 (Lookup L1)、PointX / PointY (數字，0.0~1.0) 。
●	內容屬性：次工項、缺失內容、廠商 。
●	狀態與照片：狀態 (待改善/修繕完成)、缺失照片、改善照片 。
________________________________________
三、 後台 APP：點位設定器規格 (Backend App)
●	佈局：16:9 平板/電腦大畫面介面。
●	核心技術：40x40 網格感應 (Grid Sensor) ：
○	於地圖上方疊加 40x40 透明網格。
○	點擊時捕捉格位並計算比例座標：X = (Col/40), Y = (Row/40) 。
●	產出物：於 L1b 建立具備空間意義的固定座標點。
________________________________________
四、 前台 APP：現場查驗器規格 (Frontend App)
●	佈局：手機版垂直行動介面。
●	四階段導覽邏輯 ：
1.	第一頁 (棟別選擇)：快速鎖定建築物。
2.	第二頁 (樓層選擇)：進入特定查驗平面。
3.	第三頁 (工項摘要)：列出該樓層所有工項及其待改善件數（如：木門 3 筆、油漆 0 筆） 。
4.	第四頁 (地圖落點)：點擊 L1b 固定點位進行查驗，圓圈燈號根據 L3 狀態顯示（紅/綠/灰） 。
●	智慧驗收機制：點擊紅燈 -> 上傳「改善照片」 -> 系統自動完成存檔並將狀態轉為「修繕完成」 。
________________________________________
五、 模組化擴充原則 (Scaling Standard)
針對您提到的 01~10 工程階段，系統擴充步驟如下 ：
1.	清單複製：依照 L3 Template 規格，為新工程建立對應清單（例如 08G 廚具工程即建立 L3g）。
2.	內容匯入：將您提供的各工程子資料夾名稱（如 07A, 07B 等）匯入 L2a 目錄。
3.	APP 快速生成：複製現有 APP 範本，利用「全域搜尋與取代」將 L3a 替換為 L3g，其餘地圖與表單邏輯不需任何更動 。
________________________________________
六、 關鍵技術防護 (Technical Guardrails)
●	座標防跑位公式 ：
○	所有點位位置計算必須遵循：實際位置 = 比例座標 * 當前容器寬度 。
○	地圖容器長寬比必須與原始圖片一致：Height = Width * (OriginalHeight / OriginalWidth) 。
這份規格書確保了系統在「辦公室標定」與「現場查驗」之間數據的完美對接。您現在可以根據此標準開始建立 L1b 點位主檔 與 L3a 紀錄範本。
















































00000 
114/12/31
沒問題，這是一份經過我們剛剛深入討論、定案後的 **「M365 品管系統 (GEMS) - 高效能分流架構規格書 v2.0」**。

您可以將這份資料直接存檔，作為開發文件，或提供給其他協作人員（包含 AI）使用。這份規格書已經整合了 **「階段分流 (Sharding)」、「自動化 CSV 匯入」與「地圖/點位分離」** 的核心邏輯。

---

# 🏗️ M365 品管系統 (GEMS) - 系統架構規格書 (v2.0)

**版本日期**：2025/12/31
**架構核心**：前後台分離、工程階段資料分流 (Data Sharding)、L2 標準化選單自動入庫。

## 一、 SharePoint 資料庫架構 (Backend Schema)

系統分為三大層級：**基礎層 (Foundation)**、**目錄層 (Catalog)**、**數據層 (Data)**。

### 1. 基礎層 (Foundation Layer) - 空間與地圖

負責定義物理空間結構，不隨工程進度變動。

| 清單代碼 | 清單名稱 (List Name) | 用途描述 | 關鍵欄位結構 (Columns) | 設定備註 |
| --- | --- | --- | --- | --- |
| **L0** | **L0_MapLibrary**<br>

<br>(平面圖庫) | 儲存底圖，並定義該圖適用於哪些階段。 | • **Title**: 圖名 (例: A-2F-建築)<br>

<br>• **Building**: 棟別 (文字)<br>

<br>• **Floor**: 樓層 (文字)<br>

<br>• **Image**: 平面圖 (圖片)<br>

<br>• **ApplicablePhases**: 適用階段 (查閱項: L2_Stage, **多重選取**) | 需允許一張圖對應多個階段 (如建築圖對應內裝、門窗) |
| **L1** | **L1_ProjectMaster**<br>

<br>(戶別樓層) | 定義最小查驗單位 (戶/房)，作為資料歸戶的依據。 | • **Title**: 空間編號 (例: A-02F)<br>

<br>• **Building**: 棟別 (文字)<br>

<br>• **Floor**: 樓層 (文字)<br>

<br>• **UnitID**: 戶號 (文字) | **L1b** 與 **L3** 的父關聯表 |
| **L1b** | **L1b_SpaceCoordinates**<br>

<br>(點位座標主檔) | 定義地圖上的觸控錨點 (Anchor)。 | • **Title**: 點位說明 (例: 客廳主牆)<br>

<br>• **RoomRef**: 關聯空間 (**Lookup: L1**, 索引)<br>

<br>• **PointX**: X 比例座標 (數字)<br>

<br>• **PointY**: Y 比例座標 (數字) | 點擊此點位後，系統會抓取其 ID 來過濾 L3 資料 |

---

### 2. 目錄層 (Catalog Layer) - 選單標準庫

由 CSV 匯入，提供 APP 下拉選單資料與自動化邏輯，避免人工輸入錯誤。

| 清單代碼 | 清單名稱 (List Name) | 用途描述 | 關鍵欄位結構 (Columns) | 資料來源 (CSV) |
| --- | --- | --- | --- | --- |
| **L2** | **L2_StageCatalog**<br>

<br>(工程階段目錄) | 定義 APP 的「階段選擇」選單。 | • **StageCode**: 階段代碼 (例: 05)<br>

<br>• **Title**: 階段名稱 (例: 內裝工程)<br>

<br>• **MapType**: 底圖類型 (文字, 選填) | `ZZZ-002...主工項.csv` |
| **L2a** | **L2_DefectMaster**<br>

<br>(缺失標準庫) | 定義工項樹狀結構與廠商對照。 | • **PhaseRef**: 階段代碼 (文字)<br>

<br>• **Title**: 主工項 (例: 木作天花)<br>

<br>• **SubItem**: 次工項 (文字)<br>

<br>• **DefectName**: 缺失內容 (文字)<br>

<br>• **Vendor**: 責任廠商 (文字, 用於自動帶入) | `ZZZ-002...驗屋次工項缺失.csv` |

---

### 3. 數據層 (Data Layer) - 查驗紀錄 (依階段分流)

為解決 SharePoint 委派限制 (2000筆) 與效能問題，**不使用單一 L3 大表**，改為依 **L2 階段** 建立獨立清單。

**通用欄位範本 (L3 Template)**：所有分流清單皆需具備以下一致欄位。

| 欄位名稱 (Field) | 類型 (Type) | 說明 | 索引設定 (Indexed) |
| --- | --- | --- | --- |
| **Title** | 單行文字 | 單號 (例: DEF-20251231-001) | 否 |
| **RoomRef** | 查閱項 (Lookup) | 關聯至 **L1 (戶別樓層)** | **是 (必要)** |
| **PinRef** | 查閱項 (Lookup) | 關聯至 **L1b (點位)** | 否 |
| **WorkItem** | 單行文字 | 工項 (來自 L2) | 否 |
| **SubItem** | 單行文字 | 次工項 (來自 L2) | 否 |
| **Defect** | 單行文字 | 缺失內容 (來自 L2) | 否 |
| **Status** | 單行文字 | 狀態 (待改善 / 修繕完成) | **是 (建議)** |
| **Vendor** | 單行文字 | 責任廠商 (自動帶入) | **是 (建議)** |
| **Photo_Before** | 圖片/附件 | 缺失照片 | - |
| **Photo_After** | 圖片/附件 | 改善照片 | - |

**實體清單列表 (範例)**：

* `L3_01_Pre` (假設工程)
* `L3_03_Structure` (結構工程)
* `L3_05_Interior` (內裝工程) **<-- 資料量最大，務必建立索引**
* `L3_07_Windows` (門窗工程)
* `L3_08_MEP` (機電工程)
* *(依此類推)*

---

## 二、 Power Apps 應用程式架構 (Frontend Logic)

### 1. 畫面導覽流程 (Navigation Flow)

1. **Screen_Project** (首頁)
* **動作**：選擇「棟別 (Building)」與「樓層 (Floor)」。
* **輸出**：設定全域變數 `gvarBuilding`, `gvarFloor`。


2. **Screen_Phase_Select** (階段選擇) **[新增]**
* **資料源**：`L2_StageCatalog`。
* **動作**：選擇工程階段 (如 05 內裝)。
* **輸出**：設定 `gvarCurrentPhase`, `gvarTargetL3List`。


3. **Screen_Map_View** (地圖檢視)
* **資料源 (底圖)**：查閱 `L0`，條件為 `Building`, `Floor`, `Phase`。
* **資料源 (點位)**：查閱 `L1b`，條件為 `RoomRef` 屬於該樓層。
* **邏輯**：點擊 L1b 圓點  設定 `gvarSelectedPin`  導航至工項選單。


4. **Screen_WorkItem_Select** (工項選擇) **[調整]**
* **資料源**：`L2_DefectMaster` (Filter: 階段 = `gvarCurrentPhase`)。
* **動作**：選擇主工項 (如 油漆)。
* **輸出**：設定 `gvarCurrentWorkItem`。


5. **Screen_Inspection_Form** (缺失表單)
* **架構**：使用 **多重表單堆疊 (Stacked Forms)** 或動態資料源。
* **邏輯**：
* 若階段為 05  顯示 `Form_Interior` (連線至 L3_05)。
* 若階段為 03  顯示 `Form_Structure` (連線至 L3_03)。


* **自動化**：廠商欄位 `Default` = `LookUp(L2_DefectMaster, 工項=...).Vendor`。



---

## 三、 CSV 匯入規範 (Import Standard)

請依照此格式整理 CSV 檔案，以便使用 SharePoint 匯入功能。

### 1. 階段目錄匯入檔 (對應 L2_StageCatalog)

* **來源**：`ZZZ-002工料編號主工項 - ZZZ-002工料編號主工項.csv`
* **建議欄位名稱**：
* `StageCode` (階段編號)
* `Title` (主工項/階段名稱)



### 2. 缺失標準庫匯入檔 (對應 L2_DefectMaster)

* **來源**：`ZZZ-002工料編號主工項 - 「驗屋次工項缺失」.csv`
* **建議欄位名稱**：
* `PhaseCode` (自行補上，或由 APP 過濾)
* `Title` (工項)
* `SubItem` (次工項)
* `DefectName` (缺失)
* `Vendor` (廠商)



---

## 四、 系統開發步驟 (Implementation Roadmap)

1. **資料匯入**：使用 SharePoint "From CSV" 功能建立 `L2_StageCatalog` 與 `L2_DefectMaster`。
2. **分流建表**：手動建立 `L3_05_Interior` 等 L3 子清單，並設定 `RoomRef` 索引。
3. **APP 串接**：
* 修改樓層頁按鈕  導向階段頁。
* 製作階段選擇頁  連接 L2_Stage。
* 修改表單頁  加入多個 Form 控制項並設定 Visible 邏輯。



這份架構圖資料是您目前「最強健」的版本，兼顧了擴充性與效能。您可以直接按此施工！

